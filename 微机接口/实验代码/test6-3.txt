IOY0 EQU 0600H
A8254 EQU IOY0+00H*2
B8254 EQU IOY0+01H*2
C8254 EQU IOY0+02H*2
CON8254 EQU IOY0+03H*2
SSTACK SEGMENT STACK
	DW 32 DUP(?)
SSTACK ENDS

CODE SEGMENT
	ASSUME CS:CODE,SS:SSTACK
START:
	MOV DX,0646H
	MOV AL,90H
	OUT DX,AL
	
	MOV AX,0000H
	MOV DS,AX
	MOV AX,OFFSET MIR6
	MOV SI,0038H
	MOV [SI],AX
	MOV AX,CS
	MOV SI,003AH
	MOV [SI],AX
	
	CLI
	MOV AL,11H
	OUT 20H,AL
	MOV AL,08H
	OUT 21H,AL
	MOV AL,04H
	OUT 21H,AL
	MOV AL,03H
	OUT 21H,AL
	MOV AL,0AFH
	OUT 21H,AL
	STI
	
	MOV DX,CON8254
	MOV AL,36H
	OUT DX,AL
	MOV DX,A8254
	MOV AL,0E8H
	OUT DX,AL
	MOV AL,03H
	OUT DX,AL
	MOV DX,CON8254
	MOV AL,76H
	OUT DX,AL
	MOV DX,B8254
	MOV AL,0E8H
	OUT DX,AL
	MOV AL,03H
	OUT DX,AL
	
	MOV BL,00H

AA:
	CMP BL,00H
	JZ L1
	CMP BL,01H
	JZ L2
	CMP BL,02H
	JZ L3
	CMP BL,03H
	JZ L4
	CMP BL,04H
	JZ L5
	CMP BL,05H
	JZ L6
	CMP BL,06H
	JZ L7
	CMP BL,07H
	JZ L8
	JMP L9
L1:
	MOV DX,0642H
	MOV AL,00H
	OUT DX,AL
	JMP AA
L2:
	MOV DX,0642H
	MOV AL,01H
	OUT DX,AL
	JMP AA
L3:
	MOV DX,0642H
	MOV AL,03H
	OUT DX,AL
	JMP AA
L4:
	MOV DX,0642H
	MOV AL,07H
	OUT DX,AL
	JMP AA
L5:
	MOV DX,0642H
	MOV AL,0FH
	OUT DX,AL
	JMP AA
L6:
	MOV DX,0642H
	MOV AL,1FH
	OUT DX,AL
	JMP AA
L7:
	MOV DX,0642H
	MOV AL,3FH
	OUT DX,AL
	JMP AA
L8:
	MOV DX,0642H
	MOV AL,7FH
	OUT DX,AL
	JMP AA
L9:
	MOV DX,0642H
	MOV AL,0FFH
	OUT DX,AL
	JMP AA
		
	
MIR6:
	CMP BL,08H
	JZ L10
	INC BL
L10:
	IRET
	
CODE ENDS
	END START
	