IOY1 EQU 0640H
PORTB EQU 0642H
CTL EQU 0646H
AD0809 EQU 0680H

SSTACK SEGMENT STACK
	DW 64 DUP(?)
SSTACK ENDS

PUBLIC VALUE
DATA SEGMENT
VALUE DB ?
DATA ENDS

CODE SEGMENT
ASSUME CS:CODE,DS:DATA

START:
	MOV AX,0000H
	MOV DS,AX
	
	;8255 INITIAL
	MOV AL,90H
	MOV DX,CTL
	OUT DX,AL

	;interupt process
	MOV AX,OFFSET MIR7
	MOV SI,003CH
	MOV [SI],AX
	
	MOV AX,SEG MIR7
	MOV SI,003EH
	MOV [SI],AX
	
	CLI
	;ICW INITIAL
	MOV AL,11H
	OUT 20H,AL
	
	MOV AL,08H
	OUT 21H,AL
	
	MOV AL,04H
	OUT 21H,AL
	
	MOV AL,01H
	OUT 21H,AL
	;OCW INITIAL
	MOV AL,01101111B
	OUT 21H,AL
	STI
	
AA1:
	MOV DX,AD0809
	OUT DX,AL
	CALL DELAY
	JMP AA1
MIR7:
	STI
	MOV DX,AD0809
	IN AL,DX
	MOV VALUE,AL
	MOV DX,PORTB
	OUT DX,AL
	MOV AL,20H
	OUT 20H,AL
	IRET
	
	
	
DELAY:
	;MOV DX,AD0809
	;IN AL,DX
	;MOV DX,PORTB
	;OUT DX,AL
	PUSH CX
	PUSH AX
	MOV CX,100H
A5:
	MOV AX,0800H
A6:
	DEC AX
	JNZ A6
	LOOP A5
	POP AX
	POP CX
	RET 
CODE ENDS
	END START