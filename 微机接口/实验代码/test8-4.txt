A8255_CON EQU 0606H
A8255_A EQU 0600H
A8255_B EQU 0602H
A8255_C EQU 0604H

IOY0 EQU 0600H
A8254 EQU IOY0+00H*2
B8254 EQU IOY0+01H*2
C8254 EQU IOY0+02H*2
CON8254 EQU IOY0+03H*2

DATA SEGMENT
TABLE1:
	DB 06H
	DB 5BH
	DB 4FH
SITE DB ?
NUM DB ?
REC DB ?
DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE,DS:DATA

START:
	MOV AX,0000H
	MOV DS,AX
	MOV AX,OFFSET MIR6
	MOV SI,0038H
	MOV [SI],AX
	MOV AX,CS
	MOV SI,003AH
	MOV [SI],AX
	
	;8259	
	CLI
	MOV AL,11H
	OUT 20H,AL
	MOV AL,08H
	OUT 21H,AL
	MOV AL,04H
	OUT 21H,AL
	MOV AL,03H
	OUT 21H,AL
	MOV AL,0AFH
	OUT 21H,AL
	STI
        ;8254
	MOV DX,0646H
	MOV AL,36H
	OUT DX,AL
	MOV DX,0640H
	MOV AL,00H
	OUT DX,AL
	MOV AL,48H
	OUT DX,AL;选定计数器0持续产生方波，频率为1000Hz
	;8255
	MOV AX,DATA
	MOV DS,AX
	LEA SI,TABLE1
	MOV DX,A8255_CON
	MOV AL,10000001B
	OUT DX,AL
	
	MOV REC,11111110B
	
B:
	MOV AL,[REC]
	MOV BX,00H
	MOV CX,03H
A:
	MOV SITE,AL
	PUSH AX
	MOV AL,[SI+BX]
	MOV NUM,AL
	POP AX
	CALL DISP
	INC BX
	ROL AL,1
	CMP AL,10111111B
	JNZ N
	MOV AL,11111110B
N:
	LOOP A
	JMP B
DISP:
	PUSH AX
	PUSH DX
	MOV AL,[SITE]
	MOV DX,A8255_A
	OUT DX,AL
	MOV AL,[NUM]
	MOV DX,A8255_B
	OUT DX,AL
	CALL DELAY
	POP DX
	POP AX
	RET

DELAY:
	PUSH CX
	MOV CX,0FFH
D2:
	LOOP D2
	POP CX
	RET
MIR6:
	PUSH AX
	MOV AH,[REC]
	ROL AH,1H
	CMP AH,10111111B
	JNZ NN
	MOV AH,11111110B
	MOV REC,AH
	POP AX
	IRET
NN:
	MOV REC,AH
	POP AX
	IRET
CODE ENDS
	END START