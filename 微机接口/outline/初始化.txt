1.8254计时器

计数器0，方式3：
MOV DX,CON8254
MOV AX,36H
OUT DX,AL

计数器1，方式3：
MOV DX,CON8254
MOV AX,76H
OUT DX,AL

计数器计数初值初始化：1s 4800h；03e8h
MOV DX,A8254
MOV AL,00H；初值
OUT DX,AL
MOV AL,48H；初值
OUT DX,AL
CALL DELAY

计数器delay，输入初始值之后就可以用：
DELAY:PUSH CX
MOV AL,05H
AA1:MOV CX,0FFH
AA0:LOOP AA0
SUB AL,1
JNZ AA1
POP CX
RET

计数器0，方式0：
MOV DX,CON8254
MOV AL,10H
OUT DX,AL

MOV DX,A8254
MOV AL,04H;初值
OUT DX,AL

2.8259中断

MOV AX,00H
MOV DS,AX

PUSH DX
MOV AX,OFFSET MIR6
MOV SI,0038H
MOV [SI],AX
MOV AX,CS
MOV SI,003AH
MOV [SI],AX
POP DX

CLI

MOV AL,11H
OUT 20H,AL
MOV AL,08H
OUT 21H,AL
MOV AL,04H
OUT 21H,AL
MOV AL,03H
OUT 21H,AL
MOV AL,2FH
OUT 21H,AL

STI

3.键盘扫描

键盘码，送到B口输出：
DB 3FH
DB 06H
DB 5BH
DB 4FH
DB 66H
DB 6DH
DB 7DH
DB 07H
DB 7FH
DB 6FH
DB 77H
DB 7CH
DB 39H
DB 5EH
DB 79H
DB 71H
DB 00H

BEGIN:CALL DIS
CALL CCSCAN
JNZ INK1;有键按下去处理
JMP BEGIN

INK1:CALL DIS;消除抖动
CALL DALLY
CALL DALLY
CALL CCSCAN
JNZ INK2
JMP BEGIN

;确定按下键的位置
INK2:MOV CH,0FEH
MOV CL,00H

;列循环,即扫描列,从第一列开始
COLUM:MOV AL,CH
MOV DX,A8255
OUT DX,AL

MOV DX,C8255
IN AL,DX
    
L1:TEST AL,01H
JNZ L2
MOV AL,00H
JMP KCODE

L2:TEST AL,02H
JNZ L3
MOV AL,04H
JMP KCODE

L3:TEST AL,04H
JNZ L4
MOV AL,08H
JMP KCODE

L4:TEST AL,08H
JNZ NEXT;寻找下一列
MOV AL,0CH
JMP KCODE

KCODE:ADD AL,CL
CALL PUTBUF;找到了AL就是这个数码，去处理


NEXT:INC CL
MOV AL,CH
TEST AL,08H
JZ BEGIN
ROL AL,1
MOV CH,AL
JMP COLUM

扫描函数
CCSCAN:MOV AL,00H             	
MOV DX,A8255
OUT DX,AL

MOV DX,C8255
IN AL,DX

NOT AL
AND AL,0FH;如果有位的值为1，那么接下来处理，有键按下
RET


